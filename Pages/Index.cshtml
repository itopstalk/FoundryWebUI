@page
@model IndexModel
@{
    ViewData["Title"] = "Chat";
}

<div class="d-flex flex-column h-100">
        <!-- Provider Status Panel -->
        <div id="foundry-status-panel" class="p-2 border-bottom d-flex align-items-center gap-3" style="font-size: 0.85rem;">
            <div class="d-flex align-items-center gap-2">
                <span class="fw-bold">Foundry Local:</span>
                <span id="foundry-status-indicator" class="badge bg-secondary">Checking...</span>
                <span id="foundry-endpoint-display" class="text-muted"></span>
            </div>
            <button id="btn-reconnect-foundry" class="btn btn-sm btn-outline-warning py-0 px-2" style="font-size: 0.8rem;" title="Clear cached endpoint and re-discover Foundry Local">
                üîÑ Reconnect
            </button>
        </div>

        <!-- Model Selector -->
        <div class="p-3 border-bottom d-flex align-items-center gap-3 flex-wrap">
            <label class="form-label mb-0 fw-bold">Model:</label>
            <select id="model-select" class="form-select form-select-sm" style="max-width: 350px;">
                <option value="">Loading models...</option>
            </select>
            <label class="form-label mb-0 fw-bold ms-3">System Prompt:</label>
            <select id="prompt-select" class="form-select form-select-sm" style="max-width: 250px;">
                <option value="">None</option>
            </select>
            <button id="btn-new-chat" class="btn btn-sm btn-outline-light ms-auto">üóëÔ∏è New Chat</button>
        </div>

        <!-- Messages -->
        <div id="chat-messages" class="flex-grow-1 overflow-auto p-3">
            <div class="text-center text-muted mt-5">
                <h4>Welcome to FoundryLocalWebUI</h4>
                <p>Select a model and start chatting</p>
            </div>
        </div>

        <!-- Input Area -->
        <div class="p-3 border-top">
            <div class="input-group">
                <textarea id="chat-input" class="form-control" rows="2" placeholder="Type your message... (Shift+Enter for new line)"
                          style="resize: none;"></textarea>
                <button id="btn-send" class="btn btn-primary" disabled>
                    <span id="send-text">Send</span>
                    <span id="send-spinner" class="spinner-border spinner-border-sm d-none"></span>
                </button>
                <button id="btn-stop" class="btn btn-danger d-none">Stop</button>
            </div>
        </div>
</div>

@section Scripts {
    <script src="~/js/chat.js" asp-append-version="true"></script>
}
